@.cursor/plans/tasks/task-NNN.md

## Выполни задачу из task-NNN.md

Прочитай файлы затронутые задачей:
```bash
cat [файл из задачи]
```

Это сложный рефакторинг — затрагивает несколько файлов и меняет структуру.

### Типичные задачи этого промпта:
- Переписать под интерфейсы для тестируемости
- Заменить глобальные переменные на Dependency Injection
- Разделить God-object на несколько структур
- Переработать слой целиком без изменения внешнего API

### Принципы:
- Не меняй внешний API — только внутреннюю структуру
- После рефакторинга все существующие тесты должны проходить
- Если тестов нет — создай минимальный smoke test перед рефакторингом
- Делай атомарно: сначала добавь новое, потом удали старое

### После выполнения:
```bash
go build ./...
go test ./...
bash .cursor/scripts/bash/snapshot-state.sh
git commit -m "[commit из задачи]"
```

Создай ТОЛЬКО изменённые файлы.
НЕ создавай: REFACTOR*.md, SUMMARY*.md, CHECKLIST*.md

После: "✅ Рефакторинг: [одна строка]"

МОДЕЛЬ: Sonnet С thinking (medium)
СТОИМОСТЬ: ~$0.30-0.60
РЕЖИМ: Agent Mode
