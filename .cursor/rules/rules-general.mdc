---
description: Canonical repo-wide engineering workflow rule
globs: "*.ts,*.tsx,*.mjs,*.js,*.scss,*.css"
alwaysApply: false
---

> NOTE: Canonical general rule. Keep cross-language workflow here; keep language specifics in `rules-js.mdc` and `rules-css.mdc`.

# General Canonical Rule

## Primary goals

1. Preserve behavior and public contracts.
2. Keep one source of truth; avoid parallel implementations.
3. Keep diffs small, reviewable, and deterministic.

## Required workflow

- Respect project config: `tsconfig.json`, `package.json`, `vite.config.*`.
- Use modern browser/web standards for current Chromium targets unless task requires legacy behavior.
- Normalize formatting with minimal churn (spaces only; keep surrounding style).
- Remove dead code and duplicate logic when safe.
- Align imports/paths with project aliases and conventions.
- If behavior is ambiguous, ask targeted questions instead of guessing.

## Quality gates

- After substantive edits, run relevant checks:
  - `npm run build`
  - `npm run build:crx`
  - `npm run dev`
- If errors are reported:
  - fix root causes, not symptoms
  - do a preventive sweep for similar patterns
  - centralize recurring fixes into a shared helper when appropriate

## Architecture guardrails

- Prefer cohesive feature modules over fragmented micro-files.
- Avoid circular dependencies and unnecessary abstractions.
- Preserve API boundaries; refactor behind stable exports.
