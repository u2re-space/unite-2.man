@use "@ui/scss/lib/ps-draggable" as *;
@use "@ui/scss/lib/ps-resizable" as *;
@use "@ui/scss/lib/ps-mechanic" as *;
@use "@ui/scss/lib/ps-properties" as *;

//
@use "@ui/scss/classes/mixins" as m;

// default styles
@mixin reset-styles {
    & { all: unset; }

    & {
        box-sizing: border-box;
        margin: 0px;
        padding: 0px;
        border: 0px;
    }

    & {
        font-size: 100%;
        font-weight: 400;
        font-family: inherit;
    }

    & {
        color: inherit;
        background-color: transparent;
    }

    & {
        text-align: start;
        text-decoration: none;
        text-transform: none;
        letter-spacing: normal;
        line-height: normal;
        white-space: normal;
        word-break: normal;
        word-wrap: normal;
        overflow-wrap: normal;
        overflow-wrap: break-word;
    }

    & {
        user-select: none;
        cursor: default;
        pointer-events: none;
    }

    & {
        contain: none;
        container-type: normal;
    }

    & {
        vertical-align: baseline;
    }
}

// variables
@mixin window-frame-variables {
    --ui-window-frame-shadow: 0 4px 12px rgb(0 0 0 / 0.15), 0 1px 3px rgb(0 0 0 / 0.1);
    --ui-window-frame-outline: #{"oklch(from --c2-on-surface(0.0, var(--current)) l c h / 0.1)"};
    --ui-window-frame-surface: #{"oklch(from --c2-surface(0.1, var(--current)) l c h / 1)"};
    --ui-window-frame-border-radius: 0.5rem;
    --ui-window-frame-border-width: 1px;
    --ui-window-frame-border-color: --c2-on-surface(0.0, var(--current));
    --ui-window-frame-padding: 0px;
    --ui-window-frame-margin: 0px;
    --ui-window-frame-height: 100%;
    --ui-window-frame-on-surface: #{"oklch(from --c2-on-surface(0.0, var(--current)) l c h / 1)"};
    --ui-window-frame-on-surface-secondary: --c2-on-surface(0.0, var(--secondary));
    --ui-window-frame-on-surface-tertiary: --c2-on-surface(0.0, var(--tertiary));
    --ui-window-frame-on-surface-quaternary: --c2-on-surface(0.0, var(--quaternary));
    --ui-window-frame-on-surface-quinary: --c2-on-surface(0.0, var(--quinary));
    --ui-window-frame-titlebar-height: 32px;
    --ui-window-frame-titlebar-padding: 0px;
    --ui-window-frame-titlebar-margin: 0px;
    --ui-window-frame-content-border-radius: 0.5rem;
    --ui-window-frame-content-border-width: 1px;
    --ui-window-frame-content-border-color: --c2-on-surface(0.0, var(--current));
    --ui-window-frame-content-background-color: --c2-surface(0.0, var(--current));
    --ui-window-frame-content-color: --c2-on-surface(0.0, var(--current));
    --ui-window-frame-content-padding: 0px;
    --ui-window-frame-content-margin: 0.125rem;
    --ui-window-frame-control-hover-bg: --c2-surface(0.1, var(--current));
    --ui-window-frame-control-active-bg: --c2-surface(0.1, var(--current));
    --ui-window-frame-control-close-hover-bg: --c2-on-surface(0.0, var(--secondary));
    --ui-window-frame-control-close-hover-color: --c2-surface(0.0, var(--secondary));
}

// layout
@mixin window-frame-layout {
    @include m.radius(var(--ui-window-frame-border-radius));
    @include m.border(var(--ui-window-frame-border-width), solid, var(--ui-window-frame-border-color));
    //@include m.shadow(var(--ui-window-frame-shadow));
    @include m.grid(minmax(0px, 1fr), minmax(0px, var(--ui-window-frame-titlebar-height)) minmax(0px, 1fr));
    @include m.center(y);
    @include m.container(ui-window-frame);

    //
    & {
        background-color: var(--ui-window-frame-surface);
        color: var(--ui-window-frame-on-surface);
        --icon-color: var(--ui-window-frame-on-surface);
        opacity: var(--opacity, 1);
    }

    & {
        padding: var(--ui-window-frame-padding);
        margin: var(--ui-window-frame-margin);
        display: grid !important;
    }

    & {
        block-size: var(--ui-window-frame-height);
    }

    & {
        position: relative;
    }

    & {
        gap: 0px;
        grid-template-areas: "titlebar" "content";
    }

    & {
        pointer-events: auto;
    }

    & {
        transform-origin: 50% 50%;
        transform-style: flat;
        transform-box: fill-box;
        transform: translate3d(var(--translate-x, 0px), var(--translate-y, 0px), 0px) scale3d(var(--scale, 1), var(--scale, 1), 1);
    }

    & { // z-index: 1 + sibling index
        --z-index-order: var(--order, sibling-index()); // z-index: 1 + custom order (order property)
        --z-index: var(--z-index-order, sibling-index());
        z-index: calc(99 + var(--z-index, 0)) !important;
    }
}

// content
@mixin content-styles {
    @include m.container(ui-content);
    @include m.radius(var(--ui-window-frame-content-border-radius));
    @include m.border(0px, solid, transparent);

    // grid-specific styles
    & { grid-area: content; display: flex; flex-direction: column; gap: 0.5rem; place-content: stretch; place-items: stretch; }
    & { // border styles
        border-block-start: none;
    }

    //
    & {
        padding: var(--ui-window-frame-content-padding);
        margin: var(--ui-window-frame-content-margin, 0.125rem);
    }

    & {
        overflow: hidden;
        inline-size: stretch;
        block-size: stretch;
    }

    & {
        background-color: transparent;//var(--ui-window-frame-content-background-color);
        color: var(--ui-window-frame-content-color);
        --icon-color: var(--ui-window-frame-content-color);
    }
}

// resize handle
@mixin resize-handle-styles {
    @include m.transition(opacity, $duration: m.$ui-duration-fast);

    & {
        inline-size: 12px;
        block-size: 12px;
    }

    & {
        cursor: nwse-resize;
        pointer-events: auto !important;
    }

    & {
        position: absolute !important;
        inset: auto !important;
        inset-inline-end: 0px !important;
        inset-block-end: 0px !important;
    }

    & {
        border-radius: 50%;
        border-end-start-radius: 0.15rem;
        border-start-end-radius: 0.15rem;
        border-width: 0px;
        border-style: solid;
        border-color: transparent;
    }

    & {
        color: transparent;
        background-color: var(--ui-window-frame-on-surface);
        opacity: 0.1;
    }

    &:hover { opacity: 0.2; }
    &:active { opacity: 0.3; }
}

// titlebar
@mixin titlebar-layout {
    @include m.container(ui-titlebar);
    @include m.flex(row, space-between, center);

    //
    & { // sizing
        inline-size: stretch;
        block-size: stretch;
        max-block-size: 2rem;
    }

    //
    & { // other styles
        gap: 0px;
        pointer-events: auto;
        background-color: transparent;
    }
}

// titlebar handle
@mixin titlebar-handle-styles {
    @include m.flex(row, flex-start, center);
    @include m.container(ui-titlebar-handle);

    & { // interaction
        pointer-events: auto !important;
    }

    & { // sizing
        inline-size: stretch;
        block-size: stretch;
        min-inline-size: 0px;
    }

    & { // colorization
        color: var(--ui-window-frame-on-surface);
    }

    & { // spacing and paddings
        padding-inline-start: 12px;
        padding-inline-end: 12px;
    }

    & { // flex options
        flex: 1 1 0px;
        gap: 8px;
        flex-basis: stretch;
    }
}

// title text
@mixin title-text-styles {
    @include m.text(m.$ui-font-title-size, 500, var(--ui-window-frame-titlebar-color));
    @include m.flex(column, flex-start, center);
    @include m.text-ellipsis();

    & {
        place-content: center;
        place-items: center;
        justify-content: center;
        align-items: flex-start;
    }

    & { // sizing
        inline-size: stretch;
        block-size: stretch;
    }

    & { // flex options
        gap: 0px;
        pointer-events: none;
        flex: 1 1 0px;
        min-inline-size: 0px;
    }
}

// subtitle text
@mixin subtitle-text-styles {
    @include m.flex(row, flex-start, center);
    @include m.text-ellipsis();
    @include m.text(m.$ui-font-subtitle-size, 400, #{"--c2-on-surface(0.0, var(--current))"});

    & { // sizing
        inline-size: max-content;
        block-size: stretch;
    }

    & { // flex options
        gap: 0px;
        flex-basis: max-content;
        flex-shrink: 0;
        place-content: center;
        place-items: center;
    }

    & { // spacing
        padding: 0px;
    }

    & { // colorization or opacity
        opacity: 0.5;
    }

    & { // interaction
        pointer-events: none;
    }
}

// app icon
@mixin app-icon-styles {
    @include m.flex(row, center, center);

    & { // sizing
        inline-size: max-content;
        block-size: stretch;
        min-inline-size: 1rem;
    }

    & { // flex options
        flex-basis: max-content;
        place-content: center;
        place-items: center;
    }

    & { // colorization
        color: --c2-on-surface(0.0, var(--current));
        --icon-color: --c2-on-surface(0.0, var(--current));
    }

    & { // spacing
        padding: 0px;
        margin: 0px;
    }

    & { // pointer events
        pointer-events: none;
    }

    ui-icon { // icon styles
        & { // sizing
            block-size: stretch;
            inline-size: auto;
            aspect-ratio: 1 / 1; // square
        }

        & { // colorization
            color: inherit;
            --icon-color: inherit;
            background-color: transparent;
        }

        & { // spacing
            border: none;
            outline: none;
            padding: 0px;
            margin: 0px;
            margin-block: 0.5rem;
        }
    }
}

// controls
@mixin controls-layout {
    @include m.flex(row, flex-end, center);

    & {
        flex-shrink: 0;
        flex-basis: max-content;
    }

    & {
        block-size: stretch;
        inline-size: max-content;
        max-block-size: 2rem;
    }

    & {
        padding: 0px;
        gap: 0px;
    }

    & {
        pointer-events: none;
    }

    ui-icon {
        & {
            inline-size: auto;
            block-size: stretch;
            aspect-ratio: 1 / 1;
        }

        & {
            color: var(--ui-window-frame-on-surface);
            background-color: transparent;
        }

        & {
            outline: none;
            border: none;
            padding: 0px;
            margin: 0px;
        }
    }
}

// control button base
@mixin control-button-base {
    @include m.transition(background-color, $duration: m.$ui-duration-fast);

    & {
        block-size: stretch;
        inline-size: auto;
        aspect-ratio: 1 / 1;
    }

    & {
        display: flex;
        place-content: center;
        place-items: center;
        flex-shrink: 0;
    }

    & {
        color: var(--ui-window-frame-on-surface);
        --icon-color: var(--ui-window-frame-on-surface);
        background-color: --c2-surface(0.1, var(--current));
        outline: none;
    }

    & {
        margin: #{m.$ui-spacing-xs};
        padding: #{m.$ui-spacing-xs};
        gap: 0px;
    }

    & {
        border: none;
        border-radius: 50%;
    }

    & { pointer-events: auto; }
    &:hover { background-color: --c2-surface(0.15, var(--current)); }
    &:active { background-color: --c2-surface(0.15, var(--current)); }
}

// close button
@mixin close-button-styles {
    & { background-color: --c2-on-surface(-0.05, var(--primary)); color: --c2-surface(0.0, var(--primary)); ui-icon { --icon-color: --c2-surface(0.0, var(--primary)); } }
    &:hover  { background-color: --c2-on-surface(-0.1, var(--primary)); color: --c2-surface(0.0, var(--primary)); ui-icon { --icon-color: --c2-surface(0.0, var(--primary)); } }
    &:active { background-color: --c2-on-surface(-0.1, var(--primary)); color: --c2-surface(0.0, var(--primary)); ui-icon { --icon-color: --c2-surface(0.0, var(--primary)); } }
}

// main styles
@layer ui-window-frame {

    // Main styles
    :host(ui-window-frame) {
        // Reset all elements
        &, & * {
            @include reset-styles;
        }

        //
        slot {
            display: contents !important;
            pointer-events: none !important;
            background-color: transparent !important;
            color: inherit !important;
            box-shadow: none !important;
            border-width: 0px !important;
            border-style: none !important;
            border-color: transparent !important;
            outline: none !important;
        }

        // Main layout
        & {
            @include window-frame-variables;
            @include window-frame-layout;
        }

        // Content area
        .ui-window-frame-content {
            @include content-styles;
        }

        // Resize handle
        .ui-window-frame-resize-handle {
            @include resize-handle-styles;
        }

        // Titlebar
        .ui-window-frame-titlebar {
            @include titlebar-layout;

            // Titlebar handle
            .ui-window-frame-titlebar-handle {
                @include titlebar-handle-styles;

                // Title text
                .ui-window-frame-titlebar-title,
                .ui-window-frame-titlebar-title-text {
                    @include title-text-styles;
                }

                // Subtitle text
                .ui-window-frame-titlebar-title-text-sub {
                    @include subtitle-text-styles;
                }

                // App icon
                .ui-window-frame-titlebar-app-icon {
                    @include app-icon-styles;
                }
            }

            // Controls
            .ui-window-frame-titlebar-controls {
                @include controls-layout;

                // Control buttons
                .ui-window-frame-titlebar-control-close,
                .ui-window-frame-titlebar-control-minimize,
                .ui-window-frame-titlebar-control-maximize {
                    @include control-button-base;
                }

                // Close button special styling
                .ui-window-frame-titlebar-control-close {
                    @include close-button-styles;
                }
            }
        }
    }
}

// functionality
:host(ui-window-frame:not([data-maximized])) {
    @include ps-draggable;
    @include ps-resizable;
    @include ps-mechanic;
}

//
:host(ui-window-frame:not([data-resizing]):not([data-dragging]):not([data-maximized]):not([data-hidden])) {
    @include m.transition(('inline-size', 'block-size'), $duration: m.$ui-duration-fast);
}

// maximized styles
:host(ui-window-frame[data-maximized]) {
    @include m.transition(('inline-size', 'block-size'), $duration: m.$ui-duration-fast);

    & { // transform styles
        transform: none;
        transform-origin: 50% 50%;
        transform-style: flat;
        transform-box: fill-box;
    }

    & { // use variables for effects
        scale: var(--scale, 1);
        opacity: var(--opacity, 1);
    }

    & { // sizing
        inline-size: stretch;
        block-size: stretch;
    }

    & { // positioning
        inset-inline-start: 0px;
        inset-block-start: 0px;
        inset-inline-end: 0px;
        inset-block-end: 0px;
    }

    & { // border styles
        border: none;
        border-radius: 0px;
        border-width: 0px;
        border-style: solid;
        border-color: transparent;
    }

    & { // outline styles
        outline: none;
        box-shadow: none;
    }
}
